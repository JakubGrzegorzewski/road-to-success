import{d as M,r as x,k as Q,c as p,o as r,a as g,w as W,m as I,t as A,u as S,v as j,f as $,B as R,_ as U,F as O,j as C,b as V,T as P,S as N,q as te,D as L,n as ne,h as q,s as se,x as ae,y as z,z as F,C as oe,E as B,l as le,g as re,p as G,G as ie,H as ue,I as de,J as me,i as ce,A as J,R as ve,K as pe,L as K,M as ke}from"./index-DFKJHRdF.js";import{S as T}from"./Style-1YIxFdQ9.js";const fe={class:"comment-component box-shadow"},ge={class:"comment-header"},Ie={key:0,class:"comment-author"},Ee={class:"comment-date"},he={class:"comment-actions"},ye=M({__name:"EditCommentComponent",props:{comment:{},taskId:{},user:{}},emits:["comment:save","comment:close"],setup(E,{emit:w}){const e=E,o=w,l=x(e.comment||{id:Math.floor(Math.random()*1e15),date:new Date().toISOString().split("T")[0],userId:e.user.id,content:"",taskId:e.taskId}),{t:f}=Q();return(a,i)=>(r(),p("div",fe,[g("div",ge,[a.user?(r(),p("h3",Ie,A(a.user.fullName||S(f)("user.you")),1)):I("",!0),g("span",Ee,A(l.value.date),1)]),W(g("textarea",{class:"comment-text multiline-text-input","onUpdate:modelValue":i[0]||(i[0]=s=>l.value.content=s)},null,512),[[j,l.value.content]]),g("div",he,[$(R,{buttonStyle:"success",onClick:i[1]||(i[1]=s=>{o("comment:close"),o("comment:save",l.value)}),"button-text":a.$t("edit.save")},null,8,["button-text"]),$(R,{buttonStyle:"warning",onClick:i[2]||(i[2]=s=>o("comment:close")),"button-text":a.$t("edit.cancel")},null,8,["button-text"])])]))}}),X=U(ye,[["__scopeId","data-v-7ecec8e3"]]),be={key:0,class:"comment-component box-shadow"},_e={class:"comment-header"},xe={class:"comment-author"},Te={class:"comment-date"},Se={class:"comment-text"},Ce={class:"comment-actions"},$e=M({__name:"CommentComponent",props:{comment:{},user:{},taskId:{}},emits:["comment:update","comment:delete"],setup(E,{emit:w}){const e=E,o=w,{t:l}=Q(),f=x(!1);return(a,i)=>(r(),p(O,null,[!f.value&&a.comment&&a.user?(r(),p("div",be,[g("div",_e,[g("h3",xe,A(a.user.fullName||S(l)("user.you")),1),g("span",Te,A(a.comment.date),1)]),g("p",Se,A(a.comment.content),1),g("div",Ce,[a.user.id===a.comment.userId?(r(),C(R,{key:0,onClick:i[0]||(i[0]=s=>f.value=!0),buttonStyle:"default","button-text":a.$t("edit.edit")},null,8,["button-text"])):I("",!0),e.comment?(r(),C(R,{key:1,onClick:i[1]||(i[1]=s=>{o("comment:delete",e.comment)}),buttonStyle:"error","button-text":a.$t("edit.delete")},null,8,["button-text"])):I("",!0)])])):I("",!0),f.value&&e.comment?(r(),C(X,{key:1,user:a.user,comment:e.comment,taskId:a.taskId,"onComment:close":i[2]||(i[2]=s=>f.value=!1),"onComment:save":i[3]||(i[3]=s=>{o("comment:update",s)})},null,8,["user","comment","taskId"])):I("",!0)],64))}}),Re=U($e,[["__scopeId","data-v-391cc50a"]]),we={class:"task"},Ae={key:0,class:"comments box-shadow"},Ne={key:1,style:{"align-self":"center"}},Oe=M({__name:"TaskComponent",props:{task:{},user:{},showDeleteTaskButton:{type:Boolean,default:!0}},emits:["update:task","delete:task"],setup(E,{emit:w}){const e=E,o=w,l=x([]),f=x(!1),a=x(null),i=x(0);function s(){a.value&&new ResizeObserver(t=>{for(let n of t)i.value=n.contentRect.height}).observe(a.value)}V(()=>{s(),e.task.commentIds.forEach(u=>{P.getById(u).then(t=>{console.log("Comment loaded:",t),t&&(console.log("Comment loaded:",t),l.value=[t,...l.value||[]])})})});function h(u){if(l.value){const t=l.value.findIndex(n=>n.id===u.id);t!==-1&&(l.value[t]=u,P.update(u))}}function d(u){l.value&&(l.value=[u,...l.value||[]],P.add(u,e.task.id))}function k(u){l.value=l.value?.filter(t=>t.id!==u.id).map(t=>t),P.deleteObject(u.id,e.task.id)}const{t:y}=Q(),D=[{value:N.CREATED,label:"statusOptions.created"},{value:N.IN_PROGRESS,label:"statusOptions.in_progress"},{value:N.COMPLETED,label:"statusOptions.completed"},{value:N.FAILED,label:"statusOptions.failed"}],b=u=>{switch(u){case N.CREATED:return"var(--primary-color)";case N.PENDING:return"var(--accent-warning)";case N.IN_PROGRESS:return"var(--accent-info)";case N.COMPLETED:return"var(--accent-success)";case N.FAILED:return"var(--accent-error)";default:return""}};return(u,t)=>(r(),p("div",we,[g("div",{class:"task-content box-shadow",ref_key:"contentDivRef",ref:a,style:ne({"border-color":b(u.task.status)})},[$(L,{modelValue:u.task.status,"onUpdate:modelValue":[t[0]||(t[0]=n=>u.task.status=n),t[1]||(t[1]=n=>o("update:task",e.task))],options:D,styles:"align-self: flex-end;",backgroundColor:b(u.task.status)},null,8,["modelValue","backgroundColor"]),te(u.$slots,"default",{},void 0),u.showDeleteTaskButton&&u.task?(r(),C(R,{key:0,class:"task-delete","button-style":"error","button-text":u.$t("advancement.task.delete"),onClick:t[2]||(t[2]=n=>o("delete:task",u.task))},null,8,["button-text"])):I("",!0)],4),l.value?(r(),p("div",Ae,[(r(!0),p(O,null,q(l.value,n=>(r(),C(Re,{comment:n,taskId:e.task.id,user:u.user,"onComment:update":h,"onComment:delete":k},null,8,["comment","taskId","user"]))),256)),f.value?(r(),C(X,{key:0,comment:null,taskId:e.task.id,user:u.user,"onComment:close":t[3]||(t[3]=n=>f.value=!1),"onComment:save":d},null,8,["taskId","user"])):I("",!0),l.value&&l.value.length===0?(r(),p("p",Ne,A(u.$t("advancement.comment.noComments")),1)):I("",!0),$(R,{style:{"align-self":"center"},"button-text":u.$t("advancement.comment.add"),buttonStyle:"default",onClick:t[4]||(t[4]=n=>f.value=!0)},null,8,["button-text"])])):I("",!0)]))}}),Y=U(Oe,[["__scopeId","data-v-f8cb2e64"]]),De={class:"snipped-buttons"},Me=M({__name:"TextSelectionComponent",props:{text:{},originalText:{}},emits:["text-highlighted"],setup(E,{emit:w}){const e=E,o=w,l=se(()=>e.text.split(" ")),f=x(!1),a=x(!1),i=x([]),s=x(null);async function h(){i.value.forEach(b=>b.classList.remove("highlighted")),i.value=[],f.value=!1,window.getSelection()?.removeAllRanges(),document.removeEventListener("click",d),await F(),a.value=e.text!==e.originalText}async function d(b){await new Promise(u=>setTimeout(u,100)),b.target.closest(".snipped-text, .snipped-buttons")||await h()}async function k(){await F();const b=window.getSelection();if(!b||!b.rangeCount||b.isCollapsed||!b.toString().trim()){await h();return}const u=b.getRangeAt(0),t=s.value;if(!t||!t.contains(u.commonAncestorContainer))return;i.value.forEach(c=>c.classList.remove("highlighted")),i.value=[],t.querySelectorAll(".snipped-word").forEach(c=>{b.containsNode(c,!0)&&(i.value.push(c),c.classList.add("highlighted"))}),i.value.length>0&&(f.value=!0,a.value=!0,b.removeAllRanges(),document.addEventListener("click",d))}const y=()=>{const b=i.value.map(u=>u.textContent?.trim()).join(" ");o("text-highlighted",{text:b,reset:!1}),h()},D=()=>{o("text-highlighted",{text:e.text,reset:!0}),h()};return V(()=>{a.value=e.text!==e.originalText}),ae(()=>{document.removeEventListener("click",d)}),(b,u)=>(r(),p("div",{ref_key:"textContainer",ref:s,class:"snipped"},[g("div",{class:"snipped-text",onMouseup:k,onTouchend:k},[(r(!0),p(O,null,q(l.value,(t,n)=>(r(),p("span",{key:`${t}-${n}`,class:"snipped-word"},A(t)+A(n<l.value.length-1?" ":""),1))),128))],32),g("div",De,[f.value?(r(),C(R,{key:0,onClick:z(y,["stop"]),"button-text":b.$t("edit.save"),"button-style":"success"},null,8,["button-text"])):I("",!0),a.value?(r(),C(R,{key:1,onClick:z(D,["stop"]),"button-text":b.$t("edit.cancel"),"button-style":"warning"},null,8,["button-text"])):I("",!0)])],512))}}),Z=U(Me,[["__scopeId","data-v-8d29f7ce"]]);function ee(E){return[T.IDEA_SELECTION,T.MULTI_TASK_ONE_REQUIREMENT_WITH_IDEA,T.ONE_TASK_MULTI_REQUIREMENTS_WITH_IDEA,T.ONE_TASK_ONE_REQUIREMENTS_WITH_IDEA].indexOf(E)!==-1}function Ue(E){return[T.ONE_TASK_ONE_REQUIREMENTS_WITH_IDEA,T.ONE_TASK_ONE_REQUIREMENT].indexOf(E)===-1}function qe(E){return[T.ONE_TASK_ONE_REQUIREMENTS_WITH_IDEA,T.ONE_TASK_ONE_REQUIREMENT].indexOf(E)===-1}function Pe(E){return[T.ONE_TASK_ONE_REQUIREMENT,T.ONE_TASK_ONE_REQUIREMENTS_WITH_IDEA,T.MULTI_TASK_ONE_REQUIREMENT,T.MULTI_TASK_ONE_REQUIREMENT_WITH_IDEA].indexOf(E)!==-1}function Le(E){return[T.IDEA_SELECTION,T.ONE_TASK_MULTI_REQUIREMENTS_WITH_IDEA,T.ONE_TASK_MULTI_REQUIREMENTS].indexOf(E)!==-1}const Be={style:{"font-weight":"300"}},Ve={style:{"font-weight":"700"}},He={style:{display:"flex","flex-direction":"column","margin-bottom":"20px"}},Ke=["onUpdate:modelValue","onChange"],Qe=M({__name:"RequirementBasedTaskComponent",props:{requirement:{},tasks:{},rankInProgress:{},rank:{},user:{}},emits:["delete:task","update:task","add:task"],setup(E,{emit:w}){const e=E,o=w;function l(a,i,s){a?s.partIdea=e.rank.idea:s.partIdea=i,o("update:task",s)}V(()=>{e.tasks.length===0&&e.rankInProgress&&o("add:task",[e.requirement.id])});function f(){return typeof window>"u"||!window.matchMedia?!1:window.matchMedia("(prefers-color-scheme: dark)").matches}return(a,i)=>(r(),p(O,null,[g("h3",Be,[g("b",Ve,A(a.requirement.number)+".",1),oe(" "+A(a.requirement.content),1)]),(r(!0),p(O,null,q(a.tasks,s=>(r(),p("div",He,[e.rankInProgress?(r(),C(Y,{key:0,task:s,user:a.user,"onUpdate:task":i[0]||(i[0]=h=>o("update:task",h)),"onDelete:task":i[1]||(i[1]=h=>o("delete:task",h)),"show-delete-task-button":S(Ue)(e.rankInProgress.style)},{default:B(()=>[W(g("textarea",{class:"multiline-text-input","onUpdate:modelValue":h=>s.content=h,onChange:h=>o("update:task",s)},null,40,Ke),[[j,s.content]]),a.rank&&s.partIdea&&S(ee)(e.rankInProgress.style)?(r(),C(Z,{key:0,text:s.partIdea,"original-text":a.rank.idea,onTextHighlighted:h=>l(h.reset,h.text,s)},null,8,["text","original-text","onTextHighlighted"])):I("",!0)]),_:2},1032,["task","user","show-delete-task-button"])):I("",!0)]))),256)),S(qe)(e.rankInProgress.style)&&a.rank?(r(),C(R,{key:0,class:"add-task-button","button-text":a.$t("advancement.task.add"),buttonStyle:f()?"default-light":"default",onClick:i[2]||(i[2]=s=>o("add:task",[a.requirement.id]))},null,8,["button-text","buttonStyle"])):I("",!0)],64))}}),We=U(Qe,[["__scopeId","data-v-8c679c1f"]]),je={style:{display:"flex","flex-direction":"column"}},ze={class:"task-content"},Fe={key:1},Ge={key:2,class:"task-requirements"},Je={key:0},Xe=M({__name:"IdeaBasedTaskComponent",props:{task:{},rankInProgress:{},rank:{},requirements:{},user:{}},emits:["delete:task","update:task"],setup(E,{emit:w}){const e=E,o=w;function l(d,k){e.rank!==void 0&&(d?e.task.partIdea=e.rank.idea:e.task.partIdea=k,o("update:task",e.task))}function f(){return Array.isArray(e.task.requirementsIds)?e.task.requirementsIds:[]}function a(d){console.log("Toggle requirement",e.task.requirementsIds,d.id),Array.isArray(e.task.requirementsIds)&&(i(d)?e.task.requirementsIds=e.task.requirementsIds.filter(k=>k!==d.id):e.task.requirementsIds.push(d.id),o("update:task",e.task))}function i(d){return f().find(k=>k===d.id)!==void 0}function s(d){return e.requirements.filter(k=>k.number===d).length>1}function h(d){return e.requirements.filter(k=>k.number===d.number).indexOf(d)+1}return(d,k)=>(r(),p("div",je,[$(Y,{task:e.task,user:d.user,"show-delete-task-button":!0,"onDelete:task":k[3]||(k[3]=y=>o("delete:task",y))},{default:B(()=>[g("div",ze,[S(ee)(d.rankInProgress.style)?(r(),C(Z,{key:0,text:e.task.partIdea,"original-text":d.rank?.idea,onTextHighlighted:k[0]||(k[0]=y=>l(y.reset,y.text))},null,8,["text","original-text"])):I("",!0),W(g("textarea",{class:"multiline-text-input","onUpdate:modelValue":k[1]||(k[1]=y=>e.task.content=y),onChange:k[2]||(k[2]=y=>o("update:task",e.task))},null,544),[[j,e.task.content]]),e.rankInProgress.style!==S(T).IDEA_SELECTION?(r(),p("h3",Fe,A(d.$t("advancement.requirements")),1)):I("",!0),e.rankInProgress.style!==S(T).IDEA_SELECTION?(r(),p("div",Ge,[(r(!0),p(O,null,q(d.requirements,y=>(r(),C(R,{key:y.id,"button-text":s(y.number)?h(y)+". "+y.number:y.number,buttonStyle:i(y)?"primary":"default","button-hint":y.content,onClick:D=>a(y)},null,8,["button-text","buttonStyle","button-hint","onClick"]))),128)),d.requirements.length===0?(r(),p("span",Je)):I("",!0)])):I("",!0)])]),_:1},8,["task","user"])]))}}),Ye=U(Xe,[["__scopeId","data-v-cf067650"]]),Ze={key:0,class:"rank"},et={class:"rank-details"},tt={class:"option-selection"},nt={class:"option-selection"},st={style:{display:"flex",gap:"15px"}},at=["innerHTML"],ot={key:0},lt={key:1,style:{display:"flex","flex-direction":"column",gap:"20px"}},rt=["src"],it=M({__name:"AdvancementDetailView",props:{id:{}},emits:["showPopup"],setup(E,{emit:w}){const e=E,o=x(null),l=x([]),f=x([]),a=x(void 0),i=x([]),s=x(),h=x([]),d=x(!1);async function k(){if(!d.value){d.value=!0,console.log("Reloading..."),l.value=[],f.value=[];try{J.getById(o.value.userId).then(c=>{console.info("User loaded:",c),a.value=c}),J.getAll().then(c=>{console.info("Users loaded:",c),i.value=c}),h.value=await ve.getAll(),s.value=h.value.find(c=>c.id===o.value.rankId),console.info("Rank loaded:",s.value);const t=s.value?.requirementIds??[];f.value=await Promise.all(t.map(c=>pe.getById(c))),console.info("Requirements loaded:",f.value);const n=o.value.taskIds??[];l.value=await Promise.all(n.map(c=>K.getById(c))),console.info("Tasks loaded:",l.value)}catch(t){console.error("Error reloading:",t)}finally{d.value=!1}}}function y(t=[]){s.value&&ke(o.value.id,s.value,t)?.then(n=>{n&&(l.value=[...l.value,{...n}])})}function D(t){const n=l.value.findIndex(c=>c.id===t.id);n!==-1&&(l.value[n]=t,K.update(t))}function b(t){l.value=l.value.filter(n=>n.id!==t.id),K.deleteObject(t.id,o.value.id)}function u(){const t=(v,_)=>({index:v,indexEnd:_});let n=[];for(const v of l.value)if(s.value&&v.partIdea!==""&&s.value.idea!==v.partIdea){const _=s.value.idea.indexOf(v.partIdea);n.push(t(_,_+v.partIdea.length))}n.sort((v,_)=>v.index-_.index);let c=[];for(let v of n){const _=c.find(H=>H!==v&&!(v.index>=H.indexEnd||v.indexEnd<=H.index));_?(_.index=Math.min(_.index,v.index),_.indexEnd=Math.max(_.indexEnd,v.indexEnd)):c.push(v)}c.sort((v,_)=>v.index-_.index);let m="";if(s.value)for(let v=0;v<=s.value.idea.length-1;v++)c.find(_=>_.index===v)&&(m+=" <span class='idea-part-highlight'> "),c.find(_=>_.indexEnd===v)&&(m+="</span> "),m+=s.value.idea[v];return m}return V(()=>{console.log("Mounted with id:",e.id),e.id&&le().then(()=>{re.getById(e.id).then(t=>{o.value=t,console.log("Rank in progress loaded:",t)}).then(k)})}),(t,n)=>{const c=ie("router-link");return r(),p(O,null,[o.value&&s.value&&h.value&&a.value&&Array.isArray(l.value)&&Array.isArray(f.value)?(r(),p("div",Ze,[g("div",et,[g("div",tt,[$(L,{modelValue:o.value.rankId,"onUpdate:modelValue":[n[0]||(n[0]=m=>o.value.rankId=m),k],label:t.$t("advancement.select")+":",options:h.value.map(m=>({value:m.id,label:m.fullName})),placeholder:"Select rank"},null,8,["modelValue","label","options"]),$(c,{to:S(G)+"ranks/"},{default:B(()=>n[8]||(n[8]=[g("button",{class:"add-button"},"✎",-1)])),_:1,__:[8]},8,["to"]),I("",!0)]),g("div",nt,[$(L,{modelValue:o.value.userId,"onUpdate:modelValue":n[2]||(n[2]=m=>o.value.userId=m),label:t.$t("advancement.selectMentee")+":",options:Object.values(i.value).map(m=>({value:m.id,label:m.fullName})),placeholder:"Select mentee"},null,8,["modelValue","label","options"]),$(L,{modelValue:o.value.mentorId,"onUpdate:modelValue":n[3]||(n[3]=m=>o.value.mentorId=m),label:t.$t("advancement.selectMentor")+":",options:Object.values(i.value).map(m=>({value:m.id,label:m.fullName})),placeholder:"Select mentor"},null,8,["modelValue","label","options"]),$(c,{to:S(G)+"add-person/"},{default:B(()=>n[9]||(n[9]=[g("button",{class:"add-button"},"✎",-1)])),_:1,__:[9]},8,["to"])]),g("div",st,[$(R,{"button-text":t.$t("advancement.generate"),buttonStyle:"primary",onClick:n[4]||(n[4]=m=>S(ue)(o.value))},null,8,["button-text"]),$(R,{"button-text":t.$t("advancement.export"),buttonStyle:"primary",onClick:n[5]||(n[5]=m=>S(de)())},null,8,["button-text"])]),g("h2",null,A(s.value.fullName),1),s.value.idea?(r(),p("p",{key:0,style:{"text-align":"justify"},innerHTML:u()},null,8,at)):I("",!0)]),S(Pe)(o.value.style)?(r(),p("div",ot,[(r(!0),p(O,null,q(f.value.sort(S(me)),m=>(r(),C(We,{key:m.id,requirement:m,"rank-in-progress":o.value,tasks:l.value.filter(v=>Array.isArray(v.requirementsIds)?v.requirementsIds.indexOf(m.id)!==-1:!1),rank:s.value,user:a.value,"onUpdate:task":D,"onDelete:task":b,"onAdd:task":n[6]||(n[6]=v=>y(v))},null,8,["requirement","rank-in-progress","tasks","rank","user"]))),128))])):I("",!0),S(Le)(o.value.style)?(r(),p("div",lt,[(r(!0),p(O,null,q(l.value,m=>(r(),C(Ye,{key:m.id,task:m,"rank-in-progress":o.value,rank:s.value,requirements:f.value,user:a.value,"onUpdate:task":D,"onDelete:task":b},null,8,["task","rank-in-progress","rank","requirements","user"]))),128)),$(R,{class:"add-task-button","button-text":t.$t("advancement.task.add"),buttonStyle:S(ce)()?"default-light":"default",onClick:n[7]||(n[7]=m=>y())},null,8,["button-text","buttonStyle"])])):I("",!0)])):I("",!0),s.value?(r(),p("img",{key:1,src:"data:image/png;base64,"+s.value.iconInBase64,style:{width:"500px",height:"auto",position:"fixed","z-index":"-1",top:"200px",right:"50px",opacity:"0.3",transform:"rotate(-15deg)"},alt:"rank-image"},null,8,rt)):I("",!0)],64)}}}),mt=U(it,[["__scopeId","data-v-323e99a3"]]);export{mt as default};
