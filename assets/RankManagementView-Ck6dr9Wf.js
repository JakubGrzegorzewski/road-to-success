import{d as Y,j as Z,r as s,b as ee,c as m,a as n,f as h,t as u,D as te,w as f,v as k,F as B,g as C,B as p,x as ne,o as r,h as F,k as M,n as le,_ as oe}from"./index-IRkM2OJa.js";import{R as w}from"./Rank-C0-pCPXc.js";import{R as O}from"./Requirement-D2RfjDB5.js";const ae={style:{display:"flex"}},ue={class:"input-list"},se=["onUpdate:modelValue","placeholder"],ie={class:"input-list"},re=["onUpdate:modelValue","placeholder"],de={class:"input-list"},ce={style:{display:"flex",gap:"8px",width:"100%"}},me=["onUpdate:modelValue","placeholder"],pe=["onUpdate:modelValue","placeholder"],ve={class:"input-list"},fe={class:"input-list-item",style:{"flex-direction":"column"}},ke={class:"input-list"},be={class:"input-list-item",style:{"flex-direction":"column"}},he={type:"submit"},ge={class:"form"},ye={style:{display:"flex",gap:"8px",width:"100%"}},Re=Y({__name:"RankManagementView",emits:["showPopup"],setup($e,{emit:T}){const{t:v}=Z(),I=T,V=s([]),S=s([]),b=s(null),P=s(0),g=s(""),y=s(""),R=s(""),N=s(null),U=s(null),$=s("#000000"),d=s([""]),c=s([""]),i=s([{number:"",content:""}]);ee(()=>{x()});function x(){g.value="",y.value="",R.value="",d.value=[""],c.value=[""],i.value=[{number:"",content:""}],$.value="#000000",N.value=null,U.value=null,b.value=null,w.getAll().then(t=>{S.value=t}),V.value=JSON.parse(window.localStorage.getItem("Ranks")||"[]")}const j=()=>d.value.push(""),A=t=>d.value.splice(t,1),H=()=>c.value.push(""),J=t=>c.value.splice(t,1),G=()=>i.value.push({number:"",content:""}),K=t=>i.value.splice(t,1);function Q(t){w.deleteObject(t),V.value=JSON.parse(window.localStorage.getItem("Ranks")||"[]"),I("showPopup",v("rank.rank"),v("info.deleted"))}function _(t){x();const e=S.value.find(l=>l.id===t);e&&(b.value=e,g.value=e.fullName,y.value=e.shortName,R.value=e.idea,d.value=[...e.startRequirements],c.value=[...e.endRequirements],$.value=e.colorHex,i.value=[],e.requirementIds.forEach(l=>{S.value&&O.getById(l).then(o=>{i.value.push({number:o.number,content:o.content})})}))}const E=()=>Math.floor(Math.random()*1e15);function z(t){return t.map(e=>e.trim()).filter(e=>e.length>0)}async function W(){const t=E(),e={id:t,fullName:g.value.trim(),shortName:y.value.trim(),idea:R.value.trim(),startRequirements:z(d.value),endRequirements:z(c.value),requirementIds:[],ranksInProgressIds:[],colorHex:$.value.trim(),iconInBase64:await D(N.value),backgroundInBase64:await D(U.value)};let l=[];i.value.map(o=>({number:(o.number||"").trim(),content:(o.content||"").trim()})).filter(o=>o.content.length>0).forEach(o=>{const a={id:E(),number:o.number||"",content:o.content,rankId:t,taskIds:[]};l.push(a)}),l.forEach(o=>{O.add(o)}),e.requirementIds=l.map(o=>o.id),b.value?(e.iconInBase64===""&&(e.iconInBase64=b.value.iconInBase64),e.backgroundInBase64===""&&(e.backgroundInBase64=b.value.backgroundInBase64),b.value.id<10?(await w.add(e),I("showPopup",v("rank.rank"),v("info.added"))):(e.id=b.value.id,await w.update(e),I("showPopup",v("rank.rank"),v("info.edited"))),x()):(await w.add(e),I("showPopup",v("rank.rank"),v("info.added")),x())}function X(t,e){const l=e*1024;return t.size>l?(alert(`File too large. Max ${e} KB.`),!1):!0}function D(t){return t?new Promise((e,l)=>{const o=new FileReader;o.onload=()=>{const q=o.result.split(",")[1]??"";e(q)},o.onerror=()=>l(o.error),o.readAsDataURL(t)}):Promise.resolve("")}function L(t,e=2e3,l){const o=l==="iconFile"?N:U,a=t.target,q=a?.files?.[0]??null;if(!q){o.value=null;return}if(!X(q,e)){a&&(a.value=""),o.value=null;return}o.value=q}return(t,e)=>(r(),m("div",ae,[n("form",{onSubmit:ne(W,["prevent"]),class:"form"},[n("div",null,[n("label",null,u(t.$t("rank.basedOn")),1),h(te,{modelValue:P.value,"onUpdate:modelValue":[e[0]||(e[0]=l=>P.value=l),e[1]||(e[1]=l=>{_(l)})],options:S.value.map(l=>({label:l.fullName,value:l.id})),backgroundColor:"var(--primary-color)"},null,8,["modelValue","options"]),n("small",null,u(t.$t("info.change")),1)]),n("div",null,[n("label",null,u(t.$t("rank.fullName")),1),f(n("input",{class:"text-input-component custom-input","onUpdate:modelValue":e[2]||(e[2]=l=>g.value=l),required:""},null,512),[[k,g.value]])]),n("div",null,[n("label",null,u(t.$t("rank.shortName")),1),f(n("input",{class:"text-input-component custom-input","onUpdate:modelValue":e[3]||(e[3]=l=>y.value=l)},null,512),[[k,y.value]])]),n("div",null,[n("label",null,u(t.$t("rank.idea")),1),f(n("textarea",{class:"text-input-component custom-input","onUpdate:modelValue":e[4]||(e[4]=l=>R.value=l)},null,512),[[k,R.value]])]),n("div",ue,[n("label",null,u(t.$t("rank.startRequirements")),1),(r(!0),m(B,null,C(d.value,(l,o)=>(r(),m("div",{key:`start-${o}`,class:"input-list-item"},[f(n("input",{class:"text-input-component custom-input","onUpdate:modelValue":a=>d.value[o]=a,placeholder:t.$t("content")},null,8,se),[[k,d.value[o]]]),d.value.length>1?(r(),F(p,{key:0,buttonStyle:"error",onClick:a=>A(o),"button-text":"-"},null,8,["onClick"])):M("",!0)]))),128)),h(p,{style:{"align-self":"flex-end"},buttonStyle:"success","button-text":"+",onClick:j})]),n("div",ie,[n("label",null,u(t.$t("rank.endRequirements")),1),(r(!0),m(B,null,C(c.value,(l,o)=>(r(),m("div",{key:`end-${o}`,class:"input-list-item"},[f(n("input",{class:"text-input-component custom-input","onUpdate:modelValue":a=>c.value[o]=a,placeholder:t.$t("content")},null,8,re),[[k,c.value[o]]]),c.value.length>1?(r(),F(p,{key:0,buttonStyle:"error",onClick:a=>J(o),"button-text":"-"},null,8,["onClick"])):M("",!0)]))),128)),h(p,{style:{"align-self":"flex-end"},buttonStyle:"success","button-text":"+",onClick:H})]),n("div",de,[n("label",null,u(t.$t("rank.requirements")),1),(r(!0),m(B,null,C(i.value,(l,o)=>(r(),m("div",{key:`req-${o}`,class:"input-list-item"},[n("div",ce,[f(n("input",{class:"text-input-component custom-input","onUpdate:modelValue":a=>i.value[o].number=a,style:{width:"100px"},placeholder:t.$t("requirement.number")},null,8,me),[[k,i.value[o].number]]),f(n("input",{class:"text-input-component custom-input","onUpdate:modelValue":a=>i.value[o].content=a,style:{},placeholder:t.$t("requirement.description")},null,8,pe),[[k,i.value[o].content]])]),n("div",null,[i.value.length>1?(r(),F(p,{key:0,buttonStyle:"error",onClick:a=>K(o),"button-text":"-"},null,8,["onClick"])):M("",!0)])]))),128)),h(p,{style:{"align-self":"flex-end"},buttonStyle:"success","button-text":"+",onClick:G})]),n("div",null,[n("label",null,u(t.$t("rank.color")),1),n("div",null,[f(n("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>$.value=l),type:"color"},null,512),[[k,$.value]])])]),n("div",ve,[n("label",null,u(t.$t("rank.icon")),1),n("div",fe,[n("input",{class:"text-input-component custom-input",accept:".png",type:"file",onChange:e[6]||(e[6]=l=>L(l,2e3,"iconFile"))},null,32),n("small",null,u(t.$t("info.fileSizeLimit")),1)])]),n("div",ke,[n("label",null,u(t.$t("rank.documentBackground")),1),n("div",be,[n("input",{class:"text-input-component custom-input",accept:".png",type:"file",onChange:e[7]||(e[7]=l=>L(l,2e3,"documentBackgroundFile"))},null,32),n("small",null,u(t.$t("info.fileSizeLimit")),1)])]),n("button",he,[h(p,{buttonStyle:"success","button-text":t.$t("rank.add")},null,8,["button-text"])])],32),n("div",ge,[n("h2",null,u(t.$t("rank.existingRanks")),1),(r(!0),m(B,null,C(V.value,l=>(r(),m("div",{key:l.id,class:"rank-item box-shadow",style:le(l.iconInBase64?{backgroundImage:`url(data:image/png;base64,${l.iconInBase64})`}:{})},[n("h3",null,u(l.fullName)+" ("+u(l.shortName)+")",1),n("div",ye,[h(p,{buttonStyle:"info",onClick:o=>_(l.id),"button-text":t.$t("rank.edit")},null,8,["onClick","button-text"]),h(p,{buttonStyle:"error",onClick:o=>Q(l.id),"button-text":t.$t("rank.delete")},null,8,["onClick","button-text"])])],4))),128))])]))}}),Se=oe(Re,[["__scopeId","data-v-1b7686d6"]]);export{Se as default};
