import{d as M,r as _,j as W,c as k,o,a as I,w as F,k as y,t as R,u as C,v as z,f as $,B as w,_ as U,F as O,h as S,b as K,T as B,S as A,m as se,D as V,n as ae,g as P,q as oe,s as le,x as G,y as J,z as re,C as H,l as ie,R as ue,p as X,E as de,G as me,i as ce,A as Y,H as j,I as ve}from"./index-IRkM2OJa.js";import{S as T}from"./Style-1YIxFdQ9.js";import{R as pe}from"./Rank-C0-pCPXc.js";import{R as ke}from"./Requirement-D2RfjDB5.js";const fe={class:"comment-component box-shadow"},ge={class:"comment-header"},Ie={key:0,class:"comment-author"},ye={class:"comment-date"},Ee={class:"comment-actions"},he=M({__name:"EditCommentComponent",props:{comment:{},taskId:{},user:{}},emits:["comment:save","comment:close"],setup(E,{emit:N}){const t=E,a=N,s=_(t.comment||{id:Math.floor(Math.random()*1e15),date:new Date().toISOString().split("T")[0],userId:t.user.id,content:"",taskId:t.taskId}),{t:f}=W();return(n,l)=>(o(),k("div",fe,[I("div",ge,[n.user?(o(),k("h3",Ie,R(n.user.fullName||C(f)("user.you")),1)):y("",!0),I("span",ye,R(s.value.date),1)]),F(I("textarea",{class:"comment-text multiline-text-input","onUpdate:modelValue":l[0]||(l[0]=e=>s.value.content=e)},null,512),[[z,s.value.content]]),I("div",Ee,[$(w,{buttonStyle:"success",onClick:l[1]||(l[1]=e=>{a("comment:close"),a("comment:save",s.value)}),"button-text":n.$t("edit.save")},null,8,["button-text"]),$(w,{buttonStyle:"warning",onClick:l[2]||(l[2]=e=>a("comment:close")),"button-text":n.$t("edit.cancel")},null,8,["button-text"])])]))}}),Z=U(he,[["__scopeId","data-v-7ecec8e3"]]),be={key:0,class:"comment-component box-shadow"},_e={class:"comment-header"},xe={class:"comment-author"},Te={class:"comment-date"},Se={class:"comment-text"},Ce={class:"comment-actions"},$e=M({__name:"CommentComponent",props:{comment:{},user:{},taskId:{}},emits:["comment:update","comment:delete"],setup(E,{emit:N}){const t=E,a=N,{t:s}=W(),f=_(!1);return(n,l)=>(o(),k(O,null,[!f.value&&n.comment&&n.user?(o(),k("div",be,[I("div",_e,[I("h3",xe,R(n.user.fullName||C(s)("user.you")),1),I("span",Te,R(n.comment.date),1)]),I("p",Se,R(n.comment.content),1),I("div",Ce,[n.user.id===n.comment.userId?(o(),S(w,{key:0,onClick:l[0]||(l[0]=e=>f.value=!0),buttonStyle:"default","button-text":n.$t("edit.edit")},null,8,["button-text"])):y("",!0),t.comment?(o(),S(w,{key:1,onClick:l[1]||(l[1]=e=>{a("comment:delete",t.comment)}),buttonStyle:"error","button-text":n.$t("edit.delete")},null,8,["button-text"])):y("",!0)])])):y("",!0),f.value&&t.comment?(o(),S(Z,{key:1,user:n.user,comment:t.comment,taskId:n.taskId,"onComment:close":l[2]||(l[2]=e=>f.value=!1),"onComment:save":l[3]||(l[3]=e=>{a("comment:update",e)})},null,8,["user","comment","taskId"])):y("",!0)],64))}}),we=U($e,[["__scopeId","data-v-391cc50a"]]),Ne={class:"task"},Re={key:0,class:"comments box-shadow"},Ae={key:1,style:{"align-self":"center"}},Oe=M({__name:"TaskComponent",props:{task:{},user:{},showDeleteTaskButton:{type:Boolean,default:!0}},emits:["update:task","delete:task"],setup(E,{emit:N}){const t=E,a=N,s=_([]),f=_(!1),n=_(null),l=_(0);function e(){n.value&&new ResizeObserver(m=>{for(let x of m)l.value=x.contentRect.height}).observe(n.value)}K(()=>{e(),t.task.commentIds.forEach(r=>{B.getById(r).then(m=>{console.log("Comment loaded:",m),m&&(console.log("Comment loaded:",m),s.value=[m,...s.value||[]])})})});function i(r){if(s.value){const m=s.value.findIndex(x=>x.id===r.id);m!==-1&&(s.value[m]=r,B.update(r))}}function h(r){s.value&&(s.value=[r,...s.value||[]],B.add(r,t.task.id))}function D(r){s.value=s.value?.filter(m=>m.id!==r.id).map(m=>m),B.deleteObject(r.id,t.task.id)}const{t:L}=W(),q=[{value:A.CREATED,label:"statusOptions.created"},{value:A.IN_PROGRESS,label:"statusOptions.in_progress"},{value:A.COMPLETED,label:"statusOptions.completed"},{value:A.FAILED,label:"statusOptions.failed"}],b=r=>{switch(r){case A.CREATED:return"var(--primary-color)";case A.PENDING:return"var(--accent-warning)";case A.IN_PROGRESS:return"var(--accent-info)";case A.COMPLETED:return"var(--accent-success)";case A.FAILED:return"var(--accent-error)";default:return""}};return(r,m)=>(o(),k("div",Ne,[I("div",{class:"task-content box-shadow",ref_key:"contentDivRef",ref:n,style:ae({"border-color":b(r.task.status)})},[$(V,{modelValue:r.task.status,"onUpdate:modelValue":[m[0]||(m[0]=x=>r.task.status=x),m[1]||(m[1]=x=>a("update:task",t.task))],options:q,styles:"align-self: flex-end;",backgroundColor:b(r.task.status)},null,8,["modelValue","backgroundColor"]),se(r.$slots,"default",{},void 0),r.showDeleteTaskButton&&r.task?(o(),S(w,{key:0,class:"task-delete","button-style":"error","button-text":r.$t("advancement.task.delete"),onClick:m[2]||(m[2]=x=>a("delete:task",r.task))},null,8,["button-text"])):y("",!0)],4),s.value?(o(),k("div",Re,[(o(!0),k(O,null,P(s.value,x=>(o(),S(we,{comment:x,taskId:t.task.id,user:r.user,"onComment:update":i,"onComment:delete":D},null,8,["comment","taskId","user"]))),256)),f.value?(o(),S(Z,{key:0,comment:null,taskId:t.task.id,user:r.user,"onComment:close":m[3]||(m[3]=x=>f.value=!1),"onComment:save":h},null,8,["taskId","user"])):y("",!0),s.value&&s.value.length===0?(o(),k("p",Ae,R(r.$t("advancement.comment.noComments")),1)):y("",!0),$(w,{style:{"align-self":"center"},"button-text":r.$t("advancement.comment.add"),buttonStyle:"default",onClick:m[4]||(m[4]=x=>f.value=!0)},null,8,["button-text"])])):y("",!0)]))}}),ee=U(Oe,[["__scopeId","data-v-f8cb2e64"]]),De={class:"snipped-buttons"},Me=M({__name:"TextSelectionComponent",props:{text:{},originalText:{}},emits:["text-highlighted"],setup(E,{emit:N}){const t=E,a=N,s=oe(()=>t.text.split(" ")),f=_(!1),n=_(!1),l=_([]),e=_(null);async function i(){l.value.forEach(b=>b.classList.remove("highlighted")),l.value=[],f.value=!1,window.getSelection()?.removeAllRanges(),document.removeEventListener("click",h),await J(),n.value=t.text!==t.originalText}async function h(b){await new Promise(r=>setTimeout(r,100)),b.target.closest(".snipped-text, .snipped-buttons")||await i()}async function D(){await J();const b=window.getSelection();if(!b||!b.rangeCount||b.isCollapsed||!b.toString().trim()){await i();return}const r=b.getRangeAt(0),m=e.value;if(!m||!m.contains(r.commonAncestorContainer))return;l.value.forEach(v=>v.classList.remove("highlighted")),l.value=[],m.querySelectorAll(".snipped-word").forEach(v=>{b.containsNode(v,!0)&&(l.value.push(v),v.classList.add("highlighted"))}),l.value.length>0&&(f.value=!0,n.value=!0,b.removeAllRanges(),document.addEventListener("click",h))}const L=()=>{const b=l.value.map(r=>r.textContent?.trim()).join(" ");a("text-highlighted",{text:b,reset:!1}),i()},q=()=>{a("text-highlighted",{text:t.text,reset:!0}),i()};return K(()=>{n.value=t.text!==t.originalText}),le(()=>{document.removeEventListener("click",h)}),(b,r)=>(o(),k("div",{ref_key:"textContainer",ref:e,class:"snipped"},[I("div",{class:"snipped-text",onMouseup:D,onTouchend:D},[(o(!0),k(O,null,P(s.value,(m,x)=>(o(),k("span",{key:`${m}-${x}`,class:"snipped-word"},R(m)+R(x<s.value.length-1?" ":""),1))),128))],32),I("div",De,[f.value?(o(),S(w,{key:0,onClick:G(L,["stop"]),"button-text":b.$t("edit.save"),"button-style":"success"},null,8,["button-text"])):y("",!0),n.value?(o(),S(w,{key:1,onClick:G(q,["stop"]),"button-text":b.$t("edit.cancel"),"button-style":"warning"},null,8,["button-text"])):y("",!0)])],512))}}),te=U(Me,[["__scopeId","data-v-8d29f7ce"]]);function ne(E){return[T.IDEA_SELECTION,T.MULTI_TASK_ONE_REQUIREMENT_WITH_IDEA,T.ONE_TASK_MULTI_REQUIREMENTS_WITH_IDEA,T.ONE_TASK_ONE_REQUIREMENTS_WITH_IDEA].indexOf(E)!==-1}function Ue(E){return[T.ONE_TASK_ONE_REQUIREMENTS_WITH_IDEA,T.ONE_TASK_ONE_REQUIREMENT].indexOf(E)===-1}function qe(E){return[T.ONE_TASK_ONE_REQUIREMENTS_WITH_IDEA,T.ONE_TASK_ONE_REQUIREMENT].indexOf(E)===-1}function Pe(E){return[T.ONE_TASK_ONE_REQUIREMENT,T.ONE_TASK_ONE_REQUIREMENTS_WITH_IDEA,T.MULTI_TASK_ONE_REQUIREMENT,T.MULTI_TASK_ONE_REQUIREMENT_WITH_IDEA].indexOf(E)!==-1}function Le(E){return[T.IDEA_SELECTION,T.ONE_TASK_MULTI_REQUIREMENTS_WITH_IDEA,T.ONE_TASK_MULTI_REQUIREMENTS].indexOf(E)!==-1}const Be={style:{"font-weight":"300"}},Ve={style:{"font-weight":"700"}},He={style:{display:"flex","flex-direction":"column","margin-bottom":"20px"}},Ke=["onUpdate:modelValue","onChange"],Qe=M({__name:"RequirementBasedTaskComponent",props:{requirement:{},tasks:{},rankInProgress:{},rank:{},user:{}},emits:["delete:task","update:task","add:task"],setup(E,{emit:N}){const t=E,a=N;function s(n,l,e){n?e.partIdea=t.rank.idea:e.partIdea=l,a("update:task",e)}K(()=>{t.tasks.length===0&&t.rankInProgress&&a("add:task",[t.requirement.id])});function f(){return typeof window>"u"||!window.matchMedia?!1:window.matchMedia("(prefers-color-scheme: dark)").matches}return(n,l)=>(o(),k(O,null,[I("h3",Be,[I("b",Ve,R(n.requirement.number)+".",1),re(" "+R(n.requirement.content),1)]),(o(!0),k(O,null,P(n.tasks,e=>(o(),k("div",He,[t.rankInProgress?(o(),S(ee,{key:0,task:e,user:n.user,"onUpdate:task":l[0]||(l[0]=i=>a("update:task",i)),"onDelete:task":l[1]||(l[1]=i=>a("delete:task",i)),"show-delete-task-button":C(Ue)(t.rankInProgress.style)},{default:H(()=>[F(I("textarea",{class:"multiline-text-input","onUpdate:modelValue":i=>e.content=i,onChange:i=>a("update:task",e)},null,40,Ke),[[z,e.content]]),n.rank&&e.partIdea&&C(ne)(t.rankInProgress.style)?(o(),S(te,{key:0,text:e.partIdea,"original-text":n.rank.idea,onTextHighlighted:i=>s(i.reset,i.text,e)},null,8,["text","original-text","onTextHighlighted"])):y("",!0)]),_:2},1032,["task","user","show-delete-task-button"])):y("",!0)]))),256)),C(qe)(t.rankInProgress.style)&&n.rank?(o(),S(w,{key:0,class:"add-task-button","button-text":n.$t("advancement.task.add"),buttonStyle:f()?"default-light":"default",onClick:l[2]||(l[2]=e=>a("add:task",[n.requirement.id]))},null,8,["button-text","buttonStyle"])):y("",!0)],64))}}),je=U(Qe,[["__scopeId","data-v-8c679c1f"]]),We={style:{display:"flex","flex-direction":"column"}},Fe={class:"task-content"},ze={key:1},Ge={key:2,class:"task-requirements"},Je={key:0},Xe=M({__name:"IdeaBasedTaskComponent",props:{task:{},rankInProgress:{},rank:{},requirements:{},user:{}},emits:["delete:task","update:task"],setup(E,{emit:N}){const t=E,a=N;function s(e,i){t.rank!==void 0&&(e?t.task.partIdea=t.rank.idea:t.task.partIdea=i,a("update:task",t.task))}function f(e){console.log("Toggle requirement",t.task.requirementsIds,e.id),Array.isArray(t.task.requirementsIds)&&(l(e)?t.task.requirementsIds=t.task.requirementsIds.filter(i=>i!==e.id):t.task.requirementsIds.push(e.id),a("update:task",t.task))}function n(){return Array.isArray(t.task.requirementsIds)?t.task.requirementsIds:[]}function l(e){return n().find(i=>i===e.id)!==void 0}return(e,i)=>(o(),k("div",We,[$(ee,{task:t.task,user:e.user,"show-delete-task-button":!0,"onDelete:task":i[3]||(i[3]=h=>a("delete:task",h))},{default:H(()=>[I("div",Fe,[C(ne)(e.rankInProgress.style)?(o(),S(te,{key:0,text:t.task.partIdea,"original-text":e.rank?.idea,onTextHighlighted:i[0]||(i[0]=h=>s(h.reset,h.text))},null,8,["text","original-text"])):y("",!0),F(I("textarea",{class:"multiline-text-input","onUpdate:modelValue":i[1]||(i[1]=h=>t.task.content=h),onChange:i[2]||(i[2]=h=>a("update:task",t.task))},null,544),[[z,t.task.content]]),t.rankInProgress.style!==C(T).IDEA_SELECTION?(o(),k("h3",ze,R(e.$t("advancement.requirements")),1)):y("",!0),t.rankInProgress.style!==C(T).IDEA_SELECTION?(o(),k("div",Ge,[(o(!0),k(O,null,P(e.requirements,h=>(o(),S(w,{key:h.id,"button-text":h.number,buttonStyle:l(h)?"primary":"default","button-hint":h.content,onClick:D=>f(h)},null,8,["button-text","buttonStyle","button-hint","onClick"]))),128)),e.requirements.length===0?(o(),k("span",Je)):y("",!0)])):y("",!0)])]),_:1},8,["task","user"])]))}}),Ye=U(Xe,[["__scopeId","data-v-313eb226"]]),Ze={key:0,class:"rank"},et={class:"rank-details"},tt={class:"option-selection"},nt={class:"option-selection"},st={style:{display:"flex",gap:"15px"}},at=["innerHTML"],ot={key:0},lt={key:1,style:{display:"flex","flex-direction":"column",gap:"20px"}},rt=["src"],it=M({__name:"AdvancementDetailView",props:{id:{}},emits:["showPopup"],setup(E,{emit:N}){const t=E,a=_(null),s=_([]),f=_([]),n=_(void 0),l=_([]),e=_(),i=_([]),h=_(!1);async function D(){if(!h.value){h.value=!0,console.log("Reloading..."),s.value=[],f.value=[];try{Y.getById(a.value.userId).then(c=>{console.info("User loaded:",c),n.value=c}),Y.getAll().then(c=>{console.info("Users loaded:",c),l.value=c}),i.value=await pe.getAll(),e.value=i.value.find(c=>c.id===a.value.rankId),console.info("Rank loaded:",e.value);const v=e.value?.requirementIds??[];f.value=await Promise.all(v.map(c=>ke.getById(c))),console.info("Requirements loaded:",f.value);const d=a.value.taskIds??[];s.value=await Promise.all(d.map(c=>j.getById(c))),console.info("Tasks loaded:",s.value)}catch(v){console.error("Error reloading:",v)}finally{h.value=!1}}}function L(v=[]){e.value&&ve(a.value.id,e.value,v)?.then(d=>{d&&(s.value=[...s.value,{...d}])})}function q(v){const d=s.value.findIndex(c=>c.id===v.id);d!==-1&&(s.value[d]=v,j.update(v))}function b(v){s.value=s.value.filter(d=>d.id!==v.id),j.deleteObject(v.id,a.value.id)}async function r(){const v=s.value.map(c=>({requirements:f.value.filter(u=>Array.isArray(c.requirementsIds)&&c.requirementsIds.indexOf(u.id)!==-1).map(u=>u.number+". "+u.content),ideaPart:c.partIdea,content:c.content.replace(/\n/g," ").replace(/\t/g," ")})),d={advancementName:e.value?.fullName,menteeName:n.value?.fullName,mentorName:n.value?.fullName,idea:e.value?.idea,themeColor:"#1E2F5C",tasks:v};try{const c=await fetch("/api/generate-pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!c.ok){console.error("Failed to generate PDF:",c.statusText);return}const p=await c.blob(),u=window.URL.createObjectURL(p),g=document.createElement("a");g.href=u,g.setAttribute("download",`${e.value?.fullName||"advancement"}.pdf`),document.body.appendChild(g),g.click(),g.parentNode?.removeChild(g),window.URL.revokeObjectURL(u)}catch(c){console.error("Error generating PDF:",c)}}async function m(){console.log("Export functionality is not yet implemented.")}function x(){const v=(u,g)=>({index:u,indexEnd:g});let d=[];for(const u of s.value)if(e.value&&u.partIdea!==""&&e.value.idea!==u.partIdea){const g=e.value.idea.indexOf(u.partIdea);d.push(v(g,g+u.partIdea.length))}d.sort((u,g)=>u.index-g.index);let c=[];for(let u of d){const g=c.find(Q=>Q!==u&&!(u.index>=Q.indexEnd||u.indexEnd<=Q.index));g?(g.index=Math.min(g.index,u.index),g.indexEnd=Math.max(g.indexEnd,u.indexEnd)):c.push(u)}c.sort((u,g)=>u.index-g.index);let p="";if(e.value)for(let u=0;u<=e.value.idea.length-1;u++)c.find(g=>g.index===u)&&(p+=" <span class='idea-part-highlight'> "),c.find(g=>g.indexEnd===u)&&(p+="</span> "),p+=e.value.idea[u];return p}return K(()=>{console.log("Mounted with id:",t.id),t.id&&ie().then(()=>{ue.getById(t.id).then(v=>{a.value=v,console.log("Rank in progress loaded:",v)}).then(D)})}),(v,d)=>{const c=de("router-link");return o(),k(O,null,[a.value&&e.value&&i.value&&n.value&&Array.isArray(s.value)&&Array.isArray(f.value)?(o(),k("div",Ze,[I("div",et,[I("div",tt,[$(V,{modelValue:a.value.rankId,"onUpdate:modelValue":[d[0]||(d[0]=p=>a.value.rankId=p),D],label:v.$t("advancement.select")+":",options:i.value.map(p=>({value:p.id,label:p.fullName})),placeholder:"Select rank"},null,8,["modelValue","label","options"]),$(c,{to:C(X)+"ranks/"},{default:H(()=>d[8]||(d[8]=[I("button",{class:"add-button"},"✎",-1)])),_:1,__:[8]},8,["to"]),y("",!0)]),I("div",nt,[$(V,{modelValue:a.value.userId,"onUpdate:modelValue":d[2]||(d[2]=p=>a.value.userId=p),label:v.$t("advancement.selectMentee")+":",options:Object.values(l.value).map(p=>({value:p.id,label:p.fullName})),placeholder:"Select mentee"},null,8,["modelValue","label","options"]),$(V,{modelValue:a.value.mentorId,"onUpdate:modelValue":d[3]||(d[3]=p=>a.value.mentorId=p),label:v.$t("advancement.selectMentor")+":",options:Object.values(l.value).map(p=>({value:p.id,label:p.fullName})),placeholder:"Select mentor"},null,8,["modelValue","label","options"]),$(c,{to:C(X)+"add-person/"},{default:H(()=>d[9]||(d[9]=[I("button",{class:"add-button"},"✎",-1)])),_:1,__:[9]},8,["to"])]),I("div",st,[$(w,{"button-text":v.$t("advancement.generate"),buttonStyle:"primary",onClick:d[4]||(d[4]=p=>r())},null,8,["button-text"]),$(w,{"button-text":v.$t("advancement.export"),buttonStyle:"primary",onClick:d[5]||(d[5]=p=>m())},null,8,["button-text"])]),I("h2",null,R(e.value.fullName),1),e.value.idea?(o(),k("p",{key:0,style:{"text-align":"justify"},innerHTML:x()},null,8,at)):y("",!0)]),C(Pe)(a.value.style)?(o(),k("div",ot,[(o(!0),k(O,null,P(f.value.sort(C(me)),p=>(o(),S(je,{key:p.id,requirement:p,"rank-in-progress":a.value,tasks:s.value.filter(u=>Array.isArray(u.requirementsIds)?u.requirementsIds.indexOf(p.id)!==-1:!1),rank:e.value,user:n.value,"onUpdate:task":q,"onDelete:task":b,"onAdd:task":d[6]||(d[6]=u=>L(u))},null,8,["requirement","rank-in-progress","tasks","rank","user"]))),128))])):y("",!0),C(Le)(a.value.style)?(o(),k("div",lt,[(o(!0),k(O,null,P(s.value,p=>(o(),S(Ye,{key:p.id,task:p,"rank-in-progress":a.value,rank:e.value,requirements:f.value,user:n.value,"onUpdate:task":q,"onDelete:task":b},null,8,["task","rank-in-progress","rank","requirements","user"]))),128)),$(w,{class:"add-task-button","button-text":v.$t("advancement.task.add"),buttonStyle:C(ce)()?"default-light":"default",onClick:d[7]||(d[7]=p=>L())},null,8,["button-text","buttonStyle"])])):y("",!0)])):y("",!0),e.value?(o(),k("img",{key:1,src:"data:image/png;base64,"+e.value.iconInBase64,style:{width:"500px",height:"auto",position:"fixed","z-index":"-1",top:"200px",right:"50px",opacity:"0.3",transform:"rotate(-15deg)"},alt:"rank-image"},null,8,rt)):y("",!0)],64)}}}),vt=U(it,[["__scopeId","data-v-92186fc6"]]);export{vt as default};
