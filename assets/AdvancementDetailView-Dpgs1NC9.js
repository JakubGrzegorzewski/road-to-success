import{d as q,r as b,k as j,c as v,o as r,a as g,w as z,m as f,t as w,u as x,v as F,f as R,B as N,_ as L,F as M,j as S,b as Q,T as V,S as D,q as ae,D as H,n as le,h as B,s as re,x as X,y as Y,z as ie,C as K,l as ue,g as de,p as Z,E as me,G as ce,H as ve,i as pe,A as ee,R as ke,I as fe,J as W,K as ge}from"./index-BsG4yKsA.js";import{S as _}from"./Style-1YIxFdQ9.js";const he={class:"comment-component box-shadow"},Ie={class:"comment-header"},Ee={key:0,class:"comment-author"},ye={class:"comment-date"},be={class:"comment-actions"},_e=q({__name:"EditCommentComponent",props:{comment:{},taskId:{},user:{}},emits:["comment:save","comment:close"],setup(h,{emit:$}){const e=h,a=$,o=b(e.comment||{id:Math.floor(Math.random()*1e15),date:new Date().toISOString().split("T")[0],userId:e.user.id,content:"",taskId:e.taskId}),{t:p}=j();return(n,d)=>(r(),v("div",he,[g("div",Ie,[n.user?(r(),v("h3",Ee,w(n.user.fullName||x(p)("user.you")),1)):f("",!0),g("span",ye,w(o.value.date),1)]),z(g("textarea",{class:"comment-text multiline-text-input","onUpdate:modelValue":d[0]||(d[0]=s=>o.value.content=s)},null,512),[[F,o.value.content]]),g("div",be,[R(N,{buttonStyle:"success",onClick:d[1]||(d[1]=s=>{a("comment:close"),a("comment:save",o.value)}),"button-text":n.$t("edit.save")},null,8,["button-text"]),R(N,{buttonStyle:"warning",onClick:d[2]||(d[2]=s=>a("comment:close")),"button-text":n.$t("edit.cancel")},null,8,["button-text"])])]))}}),te=L(_e,[["__scopeId","data-v-7ecec8e3"]]),Te={key:0,class:"comment-component box-shadow"},xe={class:"comment-header"},Se={class:"comment-author"},Ce={class:"comment-date"},$e={class:"comment-text"},Ae={class:"comment-actions"},Re=q({__name:"CommentComponent",props:{comment:{},user:{},taskId:{}},emits:["comment:update","comment:delete"],setup(h,{emit:$}){const e=h,a=$,{t:o}=j(),p=b(!1);return(n,d)=>(r(),v(M,null,[!p.value&&n.comment&&n.user?(r(),v("div",Te,[g("div",xe,[g("h3",Se,w(n.user.fullName||x(o)("user.you")),1),g("span",Ce,w(n.comment.date),1)]),g("p",$e,w(n.comment.content),1),g("div",Ae,[n.user.id===n.comment.userId?(r(),S(N,{key:0,onClick:d[0]||(d[0]=s=>p.value=!0),buttonStyle:"default","button-text":n.$t("edit.edit")},null,8,["button-text"])):f("",!0),e.comment?(r(),S(N,{key:1,onClick:d[1]||(d[1]=s=>{a("comment:delete",e.comment)}),buttonStyle:"error","button-text":n.$t("edit.delete")},null,8,["button-text"])):f("",!0)])])):f("",!0),p.value&&e.comment?(r(),S(te,{key:1,user:n.user,comment:e.comment,taskId:n.taskId,"onComment:close":d[2]||(d[2]=s=>p.value=!1),"onComment:save":d[3]||(d[3]=s=>{a("comment:update",s)})},null,8,["user","comment","taskId"])):f("",!0)],64))}}),we=L(Re,[["__scopeId","data-v-391cc50a"]]),Ne={class:"task"},Oe={key:0,class:"comments box-shadow"},De={key:1,style:{"align-self":"center"}},Me=q({__name:"TaskComponent",props:{task:{},user:{},showDeleteTaskButton:{type:Boolean,default:!0}},emits:["update:task","delete:task"],setup(h,{emit:$}){const e=h,a=$,o=b([]),p=b(!1),n=b(null),d=b(0);function s(){n.value&&new ResizeObserver(t=>{for(let l of t)d.value=l.contentRect.height}).observe(n.value)}Q(()=>{s(),e.task.commentIds.forEach(u=>{V.getById(u).then(t=>{console.log("Comment loaded:",t),t&&(console.log("Comment loaded:",t),o.value=[t,...o.value||[]])})})});function I(u){if(o.value){const t=o.value.findIndex(l=>l.id===u.id);t!==-1&&(o.value[t]=u,V.update(u))}}function m(u){o.value&&(o.value=[u,...o.value||[]],V.add(u,e.task.id))}function k(u){o.value=o.value?.filter(t=>t.id!==u.id).map(t=>t),V.deleteObject(u.id,e.task.id)}const{t:i}=j(),y=[{value:D.CREATED,label:"statusOptions.created"},{value:D.IN_PROGRESS,label:"statusOptions.in_progress"},{value:D.COMPLETED,label:"statusOptions.completed"},{value:D.FAILED,label:"statusOptions.failed"}],C=u=>{switch(u){case D.CREATED:return"var(--primary-color)";case D.PENDING:return"var(--accent-warning)";case D.IN_PROGRESS:return"var(--accent-info)";case D.COMPLETED:return"var(--accent-success)";case D.FAILED:return"var(--accent-error)";default:return""}};return(u,t)=>(r(),v("div",Ne,[g("div",{class:"task-content box-shadow",ref_key:"contentDivRef",ref:n,style:le({"border-color":C(u.task.status)})},[R(H,{modelValue:u.task.status,"onUpdate:modelValue":[t[0]||(t[0]=l=>u.task.status=l),t[1]||(t[1]=l=>a("update:task",e.task))],options:y,styles:"align-self: flex-end;",backgroundColor:C(u.task.status)},null,8,["modelValue","backgroundColor"]),ae(u.$slots,"default",{},void 0),u.showDeleteTaskButton&&u.task?(r(),S(N,{key:0,class:"task-delete","button-style":"error","button-text":u.$t("advancement.task.delete"),onClick:t[2]||(t[2]=l=>a("delete:task",u.task))},null,8,["button-text"])):f("",!0)],4),o.value?(r(),v("div",Oe,[(r(!0),v(M,null,B(o.value,l=>(r(),S(we,{comment:l,taskId:e.task.id,user:u.user,"onComment:update":I,"onComment:delete":k},null,8,["comment","taskId","user"]))),256)),p.value?(r(),S(te,{key:0,comment:null,taskId:e.task.id,user:u.user,"onComment:close":t[3]||(t[3]=l=>p.value=!1),"onComment:save":m},null,8,["taskId","user"])):f("",!0),o.value&&o.value.length===0?(r(),v("p",De,w(u.$t("advancement.comment.noComments")),1)):f("",!0),R(N,{style:{"align-self":"center"},"button-text":u.$t("advancement.comment.add"),buttonStyle:"default",onClick:t[4]||(t[4]=l=>p.value=!0)},null,8,["button-text"])])):f("",!0)]))}}),ne=L(Me,[["__scopeId","data-v-f8cb2e64"]]),Ue={class:"snipped-buttons"},qe=q({__name:"TextSelectionComponent",props:{text:{},originalText:{}},emits:["text-highlighted"],setup(h,{emit:$}){const e=h,a=$,o=b(!1),p=b(!1),n=b(null);async function d(){n.value&&Array.from(n.value.getElementsByClassName("highlighted")).forEach(y=>y.classList.remove("highlighted")),o.value=!1,window.getSelection()?.removeAllRanges(),document.removeEventListener("click",s),await Y(),p.value=e.text.length!==e.originalText.length}async function s(i){await new Promise(y=>setTimeout(y,100)),i.target.closest(".snipped-text, .snipped-buttons")||(o.value=!1,document.removeEventListener("click",s))}async function I(){await Y();const i=window.getSelection();if(!i||!i.rangeCount||i.isCollapsed||!i.toString().trim()){o.value=!1,i?.removeAllRanges(),document.removeEventListener("click",s);return}const y=i.getRangeAt(0),C=n.value;if(!C||!C.contains(y.commonAncestorContainer))return;C.querySelectorAll(".snipped-word").forEach(t=>{i.containsNode(t,!0)&&(t.classList.contains("highlighted")||t.classList.add("highlighted"))}),C.querySelectorAll(".highlighted").length>0&&(o.value=!0,p.value=e.text.length!==e.originalText.length,i.removeAllRanges(),document.addEventListener("click",s))}const m=()=>{if(!n.value)return;let i=[],y="";n.value.querySelectorAll(".snipped-word").forEach(u=>{u.classList.contains("highlighted")?(y=y+" "+u.innerText.trim(),console.log(y)):(y.length>0&&i.push(y),y="")}),console.log(i),a("text-highlighted",{text:i,reset:!1}),d()},k=()=>{a("text-highlighted",{text:e.text,reset:!0}),d()};return Q(()=>{p.value=e.text.length!==e.originalText.length}),re(()=>{document.removeEventListener("click",s)}),(i,y)=>(r(),v("div",{ref_key:"textContainer",ref:n,class:"snipped"},[g("div",{class:"snipped-text",onMouseup:I,onTouchend:I},[(r(!0),v(M,null,B(e.text,(C,u)=>(r(),v("span",{key:`${C}-${u}`,class:"snipped-word"},w(C)+w(u<e.text.length-1?" ":""),1))),128))],32),g("div",Ue,[o.value?(r(),S(N,{key:0,onClick:X(m,["stop"]),"button-text":i.$t("edit.save"),"button-style":"success"},null,8,["button-text"])):f("",!0),p.value?(r(),S(N,{key:1,onClick:X(k,["stop"]),"button-text":i.$t("edit.cancel"),"button-style":"warning"},null,8,["button-text"])):f("",!0)])],512))}}),se=L(qe,[["__scopeId","data-v-7c62c1d9"]]);function oe(h){return[_.IDEA_SELECTION,_.MULTI_TASK_ONE_REQUIREMENT_WITH_IDEA,_.ONE_TASK_MULTI_REQUIREMENTS_WITH_IDEA,_.ONE_TASK_ONE_REQUIREMENTS_WITH_IDEA].indexOf(h)!==-1}function Le(h){return[_.ONE_TASK_ONE_REQUIREMENTS_WITH_IDEA,_.ONE_TASK_ONE_REQUIREMENT].indexOf(h)===-1}function Be(h){return[_.ONE_TASK_ONE_REQUIREMENTS_WITH_IDEA,_.ONE_TASK_ONE_REQUIREMENT].indexOf(h)===-1}function Pe(h){return[_.ONE_TASK_ONE_REQUIREMENT,_.ONE_TASK_ONE_REQUIREMENTS_WITH_IDEA,_.MULTI_TASK_ONE_REQUIREMENT,_.MULTI_TASK_ONE_REQUIREMENT_WITH_IDEA].indexOf(h)!==-1}function Ve(h){return[_.IDEA_SELECTION,_.ONE_TASK_MULTI_REQUIREMENTS_WITH_IDEA,_.ONE_TASK_MULTI_REQUIREMENTS].indexOf(h)!==-1}const He={style:{"font-weight":"300"}},Ke={style:{"font-weight":"700"}},Qe={style:{display:"flex","flex-direction":"column","margin-bottom":"20px"}},We=["onUpdate:modelValue","onChange"],je=q({__name:"RequirementBasedTaskComponent",props:{requirement:{},tasks:{},rankInProgress:{},rank:{},user:{}},emits:["delete:task","update:task","add:task"],setup(h,{emit:$}){const e=h,a=$;function o(n,d,s){n?s.partIdea=e.rank.idea:s.partIdea=d,a("update:task",s)}Q(()=>{e.tasks.length===0&&e.rankInProgress&&a("add:task",[e.requirement.id])});function p(){return typeof window>"u"||!window.matchMedia?!1:window.matchMedia("(prefers-color-scheme: dark)").matches}return(n,d)=>(r(),v(M,null,[g("h3",He,[g("b",Ke,w(n.requirement.number)+".",1),ie(" "+w(n.requirement.content),1)]),(r(!0),v(M,null,B(n.tasks,s=>(r(),v("div",Qe,[e.rankInProgress?(r(),S(ne,{key:0,task:s,user:n.user,"onUpdate:task":d[0]||(d[0]=I=>a("update:task",I)),"onDelete:task":d[1]||(d[1]=I=>a("delete:task",I)),"show-delete-task-button":x(Le)(e.rankInProgress.style)},{default:K(()=>[z(g("textarea",{class:"multiline-text-input","onUpdate:modelValue":I=>s.content=I,onChange:I=>a("update:task",s)},null,40,We),[[F,s.content]]),n.rank&&s.partIdea&&x(oe)(e.rankInProgress.style)?(r(),S(se,{key:0,text:s.partIdea,"original-text":n.rank.idea,onTextHighlighted:I=>o(I.reset,I.text,s)},null,8,["text","original-text","onTextHighlighted"])):f("",!0)]),_:2},1032,["task","user","show-delete-task-button"])):f("",!0)]))),256)),x(Be)(e.rankInProgress.style)&&n.rank?(r(),S(N,{key:0,class:"add-task-button","button-text":n.$t("advancement.task.add"),buttonStyle:p()?"default-light":"default",onClick:d[2]||(d[2]=s=>a("add:task",[n.requirement.id]))},null,8,["button-text","buttonStyle"])):f("",!0)],64))}}),ze=L(je,[["__scopeId","data-v-8c679c1f"]]),Fe={style:{display:"flex","flex-direction":"column"}},Ge={class:"task-content"},Je={key:1},Xe={key:2,class:"task-requirements"},Ye={key:0},Ze=q({__name:"IdeaBasedTaskComponent",props:{task:{},rankInProgress:{},rank:{},requirements:{},user:{}},emits:["delete:task","update:task"],setup(h,{emit:$}){const e=h,a=$;function o(m,k){e.rank!==void 0&&(m?e.task.partIdea=e.rank.idea.split(" "):e.task.partIdea=k,a("update:task",e.task))}function p(){return Array.isArray(e.task.requirementsIds)?e.task.requirementsIds:[]}function n(m){console.log("Toggle requirement",e.task.requirementsIds,m.id),Array.isArray(e.task.requirementsIds)&&(d(m)?e.task.requirementsIds=e.task.requirementsIds.filter(k=>k!==m.id):e.task.requirementsIds.push(m.id),a("update:task",e.task))}function d(m){return p().find(k=>k===m.id)!==void 0}function s(m){return e.requirements.filter(k=>k.number===m).length>1}function I(m){return e.requirements.filter(k=>k.number===m.number).indexOf(m)+1}return(m,k)=>(r(),v("div",Fe,[R(ne,{task:e.task,user:m.user,"show-delete-task-button":!0,"onDelete:task":k[3]||(k[3]=i=>a("delete:task",i))},{default:K(()=>[g("div",Ge,[x(oe)(m.rankInProgress.style)?(r(),S(se,{key:0,text:e.task.partIdea,"original-text":m.rank?.idea.split(" "),onTextHighlighted:k[0]||(k[0]=i=>o(i.reset,i.text))},null,8,["text","original-text"])):f("",!0),z(g("textarea",{class:"multiline-text-input","onUpdate:modelValue":k[1]||(k[1]=i=>e.task.content=i),onChange:k[2]||(k[2]=i=>a("update:task",e.task))},null,544),[[F,e.task.content]]),e.rankInProgress.style!==x(_).IDEA_SELECTION?(r(),v("h3",Je,w(m.$t("advancement.requirements")),1)):f("",!0),e.rankInProgress.style!==x(_).IDEA_SELECTION?(r(),v("div",Xe,[(r(!0),v(M,null,B(m.requirements,i=>(r(),S(N,{key:i.id,"button-text":s(i.number)?I(i)+". "+i.number:i.number,buttonStyle:d(i)?"primary":"default","button-hint":i.content,onClick:y=>n(i)},null,8,["button-text","buttonStyle","button-hint","onClick"]))),128)),m.requirements.length===0?(r(),v("span",Ye)):f("",!0)])):f("",!0)])]),_:1},8,["task","user"])]))}}),et=L(Ze,[["__scopeId","data-v-23e7bc06"]]),tt={key:0,class:"rank"},nt={class:"rank-details"},st={class:"option-selection"},ot={class:"option-selection"},at={style:{display:"flex",gap:"15px"}},lt=["innerHTML"],rt={key:0},it={key:1,style:{display:"flex","flex-direction":"column",gap:"20px"}},ut=["src"],dt=q({__name:"AdvancementDetailView",props:{id:{}},emits:["showPopup"],setup(h,{emit:$}){const e=h,a=b(null),o=b([]),p=b([]),n=b(void 0),d=b([]),s=b(),I=b([]),m=b(!1);async function k(){if(!m.value){m.value=!0,console.log("Reloading..."),o.value=[],p.value=[];try{ee.getById(a.value.userId).then(E=>{console.info("User loaded:",E),n.value=E}),ee.getAll().then(E=>{console.info("Users loaded:",E),d.value=E}),I.value=await ke.getAll(),s.value=I.value.find(E=>E.id===a.value.rankId),console.info("Rank loaded:",s.value);const t=s.value?.requirementIds??[];p.value=await Promise.all(t.map(E=>fe.getById(E))),console.info("Requirements loaded:",p.value);const l=a.value.taskIds??[];o.value=await Promise.all(l.map(E=>W.getById(E))),console.info("Tasks loaded:",o.value)}catch(t){console.error("Error reloading:",t)}finally{m.value=!1}}}function i(t=[]){s.value&&ge(a.value.id,s.value,t)?.then(l=>{l&&(o.value=[...o.value,{...l}])})}function y(t){const l=o.value.findIndex(E=>E.id===t.id);l!==-1&&(o.value[l]=t,W.update(t))}function C(t){o.value=o.value.filter(l=>l.id!==t.id),W.deleteObject(t.id,a.value.id)}function u(){const t=s.value?.idea??"";if(!t)return"";const l=[];for(const T of o.value){if(T.partIdea.length===s.value?.idea.split(" ").length)continue;const G=(Array.isArray(T.partIdea)?T.partIdea:[]).map(O=>(O??"").trim()).filter(O=>O.length>0);if(G.length!==0)for(const O of G){if(!O||O===t)continue;let J=0;for(;;){const P=t.indexOf(O,J);if(P<0)break;l.push({index:P,indexEnd:P+O.length}),J=P+O.length}}}if(l.length===0)return t;l.sort((T,A)=>T.index-A.index);const E=[];for(const T of l){const A=E[E.length-1];A&&T.index<=A.indexEnd?A.indexEnd=Math.max(A.indexEnd,T.indexEnd):E.push({...T})}let c="",U=0;for(let T=0;T<t.length;T++){const A=E[U];A&&T===A.index&&(c+="<span class='idea-part-highlight'>"),c+=t[T],A&&T+1===A.indexEnd&&(c+="</span>",U++)}return c}return Q(()=>{console.log("Mounted with id:",e.id),e.id&&ue().then(()=>{de.getById(e.id).then(t=>{a.value=t,console.log("Rank in progress loaded:",t)}).then(k)})}),(t,l)=>{const E=me("router-link");return r(),v(M,null,[a.value&&s.value&&I.value&&n.value&&Array.isArray(o.value)&&Array.isArray(p.value)?(r(),v("div",tt,[g("div",nt,[g("div",st,[R(H,{modelValue:a.value.rankId,"onUpdate:modelValue":[l[0]||(l[0]=c=>a.value.rankId=c),k],label:t.$t("advancement.select")+":",options:I.value.map(c=>({value:c.id,label:c.fullName})),placeholder:"Select rank"},null,8,["modelValue","label","options"]),R(E,{to:x(Z)+"ranks/"},{default:K(()=>l[8]||(l[8]=[g("button",{class:"add-button"},"✎",-1)])),_:1,__:[8]},8,["to"]),f("",!0)]),g("div",ot,[R(H,{modelValue:a.value.userId,"onUpdate:modelValue":l[2]||(l[2]=c=>a.value.userId=c),label:t.$t("advancement.selectMentee")+":",options:Object.values(d.value).map(c=>({value:c.id,label:c.fullName})),placeholder:"Select mentee"},null,8,["modelValue","label","options"]),R(H,{modelValue:a.value.mentorId,"onUpdate:modelValue":l[3]||(l[3]=c=>a.value.mentorId=c),label:t.$t("advancement.selectMentor")+":",options:Object.values(d.value).map(c=>({value:c.id,label:c.fullName})),placeholder:"Select mentor"},null,8,["modelValue","label","options"]),R(E,{to:x(Z)+"add-person/"},{default:K(()=>l[9]||(l[9]=[g("button",{class:"add-button"},"✎",-1)])),_:1,__:[9]},8,["to"])]),g("div",at,[R(N,{"button-text":t.$t("advancement.generate"),buttonStyle:"primary",onClick:l[4]||(l[4]=c=>x(ce)(a.value))},null,8,["button-text"]),f("",!0)]),g("h2",null,w(s.value.fullName),1),s.value.idea?(r(),v("p",{key:0,style:{"text-align":"justify"},innerHTML:u()},null,8,lt)):f("",!0)]),x(Pe)(a.value.style)?(r(),v("div",rt,[(r(!0),v(M,null,B(p.value.sort(x(ve)),c=>(r(),S(ze,{key:c.id,requirement:c,"rank-in-progress":a.value,tasks:o.value.filter(U=>Array.isArray(U.requirementsIds)?U.requirementsIds.indexOf(c.id)!==-1:!1),rank:s.value,user:n.value,"onUpdate:task":y,"onDelete:task":C,"onAdd:task":l[6]||(l[6]=U=>i(U))},null,8,["requirement","rank-in-progress","tasks","rank","user"]))),128))])):f("",!0),x(Ve)(a.value.style)?(r(),v("div",it,[(r(!0),v(M,null,B(o.value,c=>(r(),S(et,{key:c.id,task:c,"rank-in-progress":a.value,rank:s.value,requirements:p.value,user:n.value,"onUpdate:task":y,"onDelete:task":C},null,8,["task","rank-in-progress","rank","requirements","user"]))),128)),R(N,{class:"add-task-button","button-text":t.$t("advancement.task.add"),buttonStyle:x(pe)()?"default-light":"default",onClick:l[7]||(l[7]=c=>i())},null,8,["button-text","buttonStyle"])])):f("",!0)])):f("",!0),s.value?(r(),v("img",{key:1,src:"data:image/png;base64,"+s.value.iconInBase64,style:{width:"500px",height:"auto",position:"fixed","z-index":"-1",top:"200px",right:"50px",opacity:"0.3",transform:"rotate(-15deg)"},alt:"rank-image"},null,8,ut)):f("",!0)],64)}}}),vt=L(dt,[["__scopeId","data-v-2dc478c8"]]);export{vt as default};
